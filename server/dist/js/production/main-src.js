!function(){"use strict";angular.module("coffeeGame",["ngRoute","ngCookies","ui.bootstrap","angular-growl","pascalprecht.translate","ngSanitize"]),angular.element(document).ready(function(){angular.bootstrap(document,["coffeeGame"])})}(),function(){"use strict";angular.module("coffeeGame").config(["$routeProvider",function(e){e.when("/index",{templateUrl:"app/pages/game/game.html"}).when("/login",{templateUrl:"app/pages/login/login.html"}).when("/register",{templateUrl:"app/pages/register/register.html"}).otherwise({redirectTo:"/index"})}])}(),function(){"use strict";function e(){var e=window.location.href,t="http://coffeegame/server";return e.indexOf("http://cafe.jaknakavu.eu/")>=0&&(t="http://cafe.jaknakavu.eu/server"),t}angular.module("coffeeGame").constant("serverUrl",e()),angular.module("coffeeGame").config(["$translateProvider","growlProvider",function(e,t){t.globalTimeToLive({success:5e3,error:5e3,warning:5e3,info:5e3}),e.translations("en",translationsEN),e.translations("cz",translationsCZ),e.translations("ru",translationsRU),e.translations("ua",translationsUA),e.preferredLanguage("en"),e.fallbackLanguage("cz"),e.useLocalStorage()}])}(),function(){"use strict";function e(e,t,n,i,o){var r=function(o){this.id=o.id,this.cafeName=o.cafeName,this.balance=-1,this.displayBalance=function(){return this.balance-this.equipment.TotalAmount()},this.equipment=new e,this.employee=new t,this.coffee={type:new n,price:new i}};return r.prototype.getBalance=function(){var e=this;return o.getBalance().success(function(t){e.balance=t})},r.prototype.isAuthenticated=function(){return""!=this.id&&void 0!=this.id},r.prototype.canBuyEquipment=function(e,t){var n=this.equipment.getItemPrice(e),i=this.employee.pricePerMonth?parseFloat(this.employee.pricePerMonth):0,o=this.coffee.type.pricePerKg?parseFloat(this.coffee.type.pricePerKg):0;return this.balance-this.equipment.TotalAmount()+n-i-o>t.price},r.prototype.canBuyEmployee=function(e){var t=this.employee.pricePerMonth?parseFloat(this.employee.pricePerMonth):0,n=this.coffee.type.pricePerKg?parseFloat(this.coffee.type.pricePerKg):0;return this.balance-this.equipment.TotalAmount()-t-n>e},r.prototype.canBuyCoffeeType=function(e){var t=this.employee.pricePerMonth?parseFloat(this.employee.pricePerMonth):0,n=this.coffee.type.pricePerKg?parseFloat(this.coffee.type.pricePerKg):0;return this.balance-this.equipment.TotalAmount()-t-n>e},r.prototype.update=function(e){3==this.equipment.items.length&&0!=this.employee.id&&0!=this.coffee.type.id&&0!=this.coffee.price.id&&e()},r}angular.module("coffeeGame").factory("User",e),e.$inject=["UserEquipment","Employee","CoffeeType","CoffeePrice","userService"]}(),function(){"use strict";function e(e,t){var n=t+"/authentication",i={};return i.validate=function(){return e.get(n+"/check.php")},i.logout=function(){return e.get(n+"/logout.php")},i.startPlay=function(){return e.get(n+"/start_play.php")},i.isPlay=function(){return e.get(n+"/is_play.php")},i.login=function(t){return e({url:n+"/auth.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({cafeName:t.cafeName,password:t.password,submit:t.submit})})},i}angular.module("coffeeGame").factory("authenticationService",e),e.$inject=["$http","serverUrl"]}(),function(){"use strict";function e(e){var t=function(){this.id=0,this.price=0};return t.prototype.Set=function(t){e.setUserEquipment(t.id,t.equipment_type_id,parseFloat(t.price)),this.id=t.id,this.price=t.price},t.prototype.update=function(e){e()},t}angular.module("coffeeGame").factory("CoffeePrice",e),e.$inject=["gameSettingsService"]}(),function(){"use strict";function e(e){var t=function(){this.id=0,this.name="",this.pricePerKg=0};return t.prototype.Set=function(t){e.setUserEquipment(t.id,t.equipment_type_id,parseFloat(t.price)),this.id=t.id,this.name=t.name,this.pricePerKg=t.price},t.prototype.update=function(e){e()},t}angular.module("coffeeGame").factory("CoffeeType",e),e.$inject=["gameSettingsService"]}(),function(){"use strict";function e(e){var t=function(){this.id=0,this.pricePerMonth=0,this.name=""};return t.prototype.Set=function(t){e.setUserEquipment(t.id,t.equipment_type_id,parseFloat(t.price)),this.id=t.id,this.pricePerMonth=t.price,this.name=t.name},t.prototype.update=function(e){e()},t}angular.module("coffeeGame").factory("Employee",e),e.$inject=["gameSettingsService"]}(),function(){"use strict";function e(e,t){var n=t+"/game/api/settings",i={};return i.getCoffeeGrinders=function(){return e.get(n+"/grinders")},i.getCoffeeMachines=function(){return e.get(n+"/machines")},i.getCoffeePlaces=function(){return e.get(n+"/places")},i.getCoffeeEmployees=function(){return e.get(n+"/employees")},i.getCoffeeTypes=function(){return e.get(n+"/coffeeTypes")},i.getCoffeePrices=function(){return e.get(n+"/coffeePrices")},i.getUserEquipment=function(){return e.get(n+"/getUserEquipment")},i.setUserEquipment=function(t,i,o){return e({url:n+"/setUserEquipment",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({equipmentId:t,equipmentTypeId:i,equipmentPrice:o})})},i}angular.module("coffeeGame").factory("gameSettingsService",e),e.$inject=["$http","serverUrl"]}(),function(){"use strict";function e(e,t,n){var i=t+"/game/api/user",o={};return o.resetData=function(){return e.get(i+"/reset-balance")},o}angular.module("coffeeGame").factory("globalService",e),e.$inject=["$http","serverUrl","$q"]}(),function(){"use strict";function e(e){var t=function(){this.items=[]};return t.prototype.Add=function(t,n){if(e.setUserEquipment(n.id,n.equipment_type_id,parseFloat(n.price)),this.Exists(t)){var i=this.IndexOf(t);this.items[i].name=t,this.items[i].id=n.id,this.items[i].price=parseFloat(n.price),this.items[i].item=n.item}else this.items.push({name:t,id:n.id,price:parseFloat(n.price),item:n})},t.prototype.Exists=function(e,t){for(var n=0;n<this.items.length;n++)if(this.items[n].name==e&&(!t||this.items[n].id==t))return!0},t.prototype.IndexOf=function(e,t){for(var n=0;n<this.items.length;n++)if(this.items[n].name==e&&(!t||this.items[n].id==t))return n},t.prototype.getItemPrice=function(e){if(this.Exists(e)){var t=this.IndexOf(e);return parseFloat(this.items[t].price)}return 0},t.prototype.TotalAmount=function(){for(var e=0,t=0;t<this.items.length;t++)e+=parseFloat(this.items[t].price);return e},t.prototype.update=function(e){e()},t}angular.module("coffeeGame").factory("UserEquipment",e),e.$inject=["gameSettingsService"]}(),function(){"use strict";function e(e,t){var n=t+"/game/api/user",i={};return i.getBalance=function(){return e.get(n+"/balance")},i.heartbeat=function(){return e.get(n+"/heartbeat")},i}angular.module("coffeeGame").factory("userService",e),e.$inject=["$http","serverUrl"]}(),function(){"use strict";function e(e,t,n,i){function o(){a||(a=n(function(){i.heartbeat()},5e3))}function r(){a&&(n.cancel(a),a=void 0)}var a;t.$on("userLogin",function(){o()}),t.$on("userLogout",function(){r()})}angular.module("coffeeGame").controller("HeartbeatCtrl",e),e.$inject=["$scope","$rootScope","$timeout","userService"]}(),function(){"use strict";function e(e,t,n,i){function o(){i.isPlay().success(function(t){angular.isUndefined(t.status)||(e.game.equipmentChooseFinished=!0)})}function r(){i.validate().success(function(t){return angular.isUndefined(t.user_id)?void(e.showGame=!1):(console.log("Login"),void(e.showGame=!0))})}e.game={},e.showGame=!1,t.$on("gameStartEvent",function(){console.log("GameCtrl gameStartEvent"),i.startPlay(),e.game.equipmentChooseFinished=!0}),t.$on("userLogin",function(t,i){e.user=new n(i),e.user.getBalance(),o()}),o(),r(),e.$on("userLogout",function(){r()}),e.$on("userLogin",function(){r()})}angular.module("coffeeGame").controller("GameCtrl",e),e.$inject=["$scope","$rootScope","User","authenticationService"]}(),function(){"use strict";function e(e,t,n,i,o){console.log("globalSettingsCtrl"),e.globalReset=function(){o.resetData().success(function(e){i.location.reload()})}}angular.module("coffeeGame").controller("globalSettingsCtrl",e),e.$inject=["$scope","$rootScope","User","$window","globalService"]}(),function(){"use strict";function e(e,t,n){function i(){n.validate().success(function(n){var i={id:n.user_id,cafeName:n.cafeName};""!=i.id&&void 0!=i.id?(e.user.authorized=!0,e.user.cafeName=i.cafeName,t.$broadcast("userLogin",i)):e.user.authorized=!1})}e.user={authorized:!1},i(),e.$on("$routeChangeStart",function(e,t){i()}),e.logout=function(){n.logout(),t.$broadcast("userLogout")}}angular.module("coffeeGame").controller("UserAuthCtrl",e),e.$inject=["$scope","$rootScope","authenticationService"]}(),function(){"use strict";function e(e){}angular.module("coffeeGame").controller("UserBalanceCtrl",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,n){e.model={cafeName:"",password:""},e.login=function(){t.login({cafeName:e.model.cafeName,password:e.model.password,submit:"submit"}).success(function(e){n.path("/")})}}angular.module("coffeeGame").controller("LoginCtrl",e),e.$inject=["$scope","authenticationService","$location"]}(),function(){"use strict";function e(e,t){$("#myModalLanguage").modal(),e.changeLanguage=function(e){t.uses(e)}}angular.module("coffeeGame").controller("TranslateCtrl",e),e.$inject=["$scope","$translate"]}(),function(){"use strict";function e(e,t){e.model={openedTime:0};var n=1e3;e.model.openedTimeDisplay=function(){return e.model.openedTime/2592},t(function(){e.model.openedTime=e.model.openedTime+1},n)}angular.module("coffeeGame").controller("GameProcessCtrl",e),e.$inject=["$scope","$interval"]}(),function(){"use strict";function e(e,t,n,i,o){function r(e){"grinder"!=e&&c(),"machine"!=e&&s(),"place"!=e&&u(),"employee"!=e&&f(),"coffe"!=e&&l(),"drink_price"!=e&&p(),a()}function a(){n.getUserEquipment().success(function(t){e.selectedEquipment=t})}function c(){n.getCoffeeGrinders().success(function(t){e.model.coffeeGrinders=t})}function s(){n.getCoffeeMachines().success(function(t){e.model.coffeeMachines=t})}function u(){n.getCoffeePlaces().success(function(t){e.model.coffeePlaces=t})}function f(){n.getCoffeeEmployees().success(function(t){e.model.coffeeEmployees=t})}function l(){n.getCoffeeTypes().success(function(t){e.model.coffeeTypes=t})}function p(){n.getCoffeePrices().success(function(t){e.model.coffeePrices=t})}function m(){console.log("errorr"),i.success(o("translate")("THANKS_YOU_FINISHED")),t.$emit("gameStartEvent")}e.tabs=[{name:"Grinder",active:!0},{name:"Machine",active:!1},{name:"Place",active:!1},{name:"Employees",active:!1},{name:"Coffee",active:!1},{name:"Drink price",active:!1}],e.selectedEquipment={grinder:null,machine:null,place:null,employee:null,coffe:null,drink_price:null},e.model={},r("all"),e.openAccordion=function(e){var t="#accordion-"+e;$(t).click()},e.addSelectedNameToEquipment=function(t,n){e.selectedEquipment[t]=n.id},e.chooseCoffeeGinder=function(t){e.user.canBuyEquipment("grinder",t)?(e.user.equipment.Add("grinder",t),e.addSelectedNameToEquipment("grinder",t),r("all"),e.openAccordion(2),i.success(o("translate")("THANKS_YOU_CHOSEN",{name:o("translate")("TABGRINDER")})),e.user.update(m)):i.warning(o("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:o("translate")("TABGRINDER")}))},e.chooseCoffeeMachine=function(t){e.user.canBuyEquipment("machine",t)?(e.user.equipment.Add("machine",t),e.addSelectedNameToEquipment("machine",t),r("all"),e.openAccordion(3),i.success(o("translate")("THANKS_YOU_CHOSEN",{name:o("translate")("TABMACHINE")})),e.user.update(m)):i.warning(o("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:o("translate")("TABMACHINE")}))},e.chooseCoffeePlace=function(t){e.user.canBuyEquipment("place",t)?(e.user.equipment.Add("place",t),e.addSelectedNameToEquipment("place",t),r("all"),e.openAccordion(4),i.success(o("translate")("THANKS_YOU_CHOSEN",{name:o("translate")("TABPLACE")})),e.user.update(m)):i.warning(o("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:o("translate")("TABPLACE")}))},e.chooseCoffeeEmployee=function(t){e.user.canBuyEmployee(t.price)?(e.user.employee.Set(t),e.addSelectedNameToEquipment("employee",t),r("all"),e.openAccordion(5),i.success(o("translate")("THANKS_YOU_CHOSEN",{name:o("translate")("TABEMPLOYEES")})),e.user.update(m)):i.warning(o("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:o("translate")("TABEMPLOYEES")}))},e.chooseCoffeeType=function(t){e.user.canBuyCoffeeType(t.price)?(e.user.coffee.type.Set(t),e.addSelectedNameToEquipment("coffe",t),r("all"),e.openAccordion(6),i.success(o("translate")("THANKS_YOU_CHOSEN",{name:o("translate")("TABCOFFEE")})),e.user.update(m)):i.warning(o("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:o("translate")("TABCOFFEE")}))},e.chooseCoffeePrice=function(t){e.user.coffee.price.Set(t),i.success(o("translate")("THANKS_YOU_CHOSEN",{name:o("translate")("TABPRICE")})),r("all"),e.addSelectedNameToEquipment("drink_price",t),e.user.update(m)}}angular.module("coffeeGame").controller("StartEquipmentChooseCtrl",e),e.$inject=["$scope","$rootScope","gameSettingsService","growl","$filter"]}();