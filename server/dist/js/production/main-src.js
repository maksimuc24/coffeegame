!function(){"use strict";angular.module("coffeeGame",["ngRoute","ngCookies","ui.bootstrap","angular-growl","pascalprecht.translate","ngSanitize"]),angular.element(document).ready(function(){angular.bootstrap(document,["coffeeGame"])})}(),function(){"use strict";angular.module("coffeeGame").config(["$routeProvider",function(e){e.when("/index",{templateUrl:"app/pages/game/game.html"}).when("/login",{templateUrl:"app/pages/login/login.html"}).when("/register",{templateUrl:"app/pages/register/register.html"}).otherwise({redirectTo:"/index"})}])}(),function(){"use strict";function e(){var e=window.location.href,t="http://coffeegame/server";return e.indexOf("http://cafe.jaknakavu.eu/")>=0&&(t="http://cafe.jaknakavu.eu/server"),t}angular.module("coffeeGame").constant("serverUrl",e()),angular.module("coffeeGame").config(["$translateProvider",function(e){e.translations("en",translationsEN),e.translations("cz",translationsCZ),e.translations("ru",translationsRU),e.translations("ua",translationsUA),e.preferredLanguage("en"),e.fallbackLanguage("cz"),e.useLocalStorage()}])}(),function(){"use strict";function e(e,t,n,o,i){var r=function(i){this.id=i.id,this.cafeName=i.cafeName,this.balance=-1,this.displayBalance=function(){return this.balance-this.equipment.TotalAmount()},this.equipment=new e,this.employee=new t,this.coffee={type:new n,price:new o}};return r.prototype.getBalance=function(){var e=this;return i.getBalance().success(function(t){e.balance=t})},r.prototype.isAuthenticated=function(){return""!=this.id&&void 0!=this.id},r.prototype.canBuyEquipment=function(e,t){var n=this.equipment.getItemPrice(e),o=this.employee.pricePerMonth?parseFloat(this.employee.pricePerMonth):0,i=this.coffee.type.pricePerKg?parseFloat(this.coffee.type.pricePerKg):0;return this.balance-this.equipment.TotalAmount()+n-o-i>t.price},r.prototype.canBuyEmployee=function(e){var t=this.employee.pricePerMonth?parseFloat(this.employee.pricePerMonth):0,n=this.coffee.type.pricePerKg?parseFloat(this.coffee.type.pricePerKg):0;return this.balance-this.equipment.TotalAmount()-t-n>e},r.prototype.canBuyCoffeeType=function(e){var t=this.employee.pricePerMonth?parseFloat(this.employee.pricePerMonth):0,n=this.coffee.type.pricePerKg?parseFloat(this.coffee.type.pricePerKg):0;return this.balance-this.equipment.TotalAmount()-t-n>e},r.prototype.update=function(e){3==this.equipment.items.length&&0!=this.employee.id&&0!=this.coffee.type.id&&0!=this.coffee.price.id&&e()},r}angular.module("coffeeGame").factory("User",e),e.$inject=["UserEquipment","Employee","CoffeeType","CoffeePrice","userService"]}(),function(){"use strict";function e(e,t){var n=t+"/authentication",o={};return o.validate=function(){return e.get(n+"/check.php")},o.logout=function(){return e.get(n+"/logout.php")},o.login=function(t){return e({url:n+"/auth.php",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({cafeName:t.cafeName,password:t.password,submit:t.submit})})},o}angular.module("coffeeGame").factory("authenticationService",e),e.$inject=["$http","serverUrl"]}(),function(){"use strict";function e(){var e=function(){this.id=0,this.price=0};return e.prototype.Set=function(e){this.id=e.id,this.price=e.price},e.prototype.update=function(e){e()},e}angular.module("coffeeGame").factory("CoffeePrice",e),e.$inject=[]}(),function(){"use strict";function e(){var e=function(){this.id=0,this.name="",this.pricePerKg=0};return e.prototype.Set=function(e){this.id=e.id,this.name=e.name,this.pricePerKg=e.price},e.prototype.update=function(e){e()},e}angular.module("coffeeGame").factory("CoffeeType",e),e.$inject=[]}(),function(){"use strict";function e(){var e=function(){this.id=0,this.pricePerMonth=0,this.name=""};return e.prototype.Set=function(e){this.id=e.id,this.pricePerMonth=e.price,this.name=e.name},e.prototype.update=function(e){e()},e}angular.module("coffeeGame").factory("Employee",e),e.$inject=[]}(),function(){"use strict";function e(e,t){var n=t+"/game/api/settings",o={};return o.getCoffeeGrinders=function(){return e.get(n+"/grinders")},o.getCoffeeMachines=function(){return e.get(n+"/machines")},o.getCoffeePlaces=function(){return e.get(n+"/places")},o.getCoffeeEmployees=function(){return e.get(n+"/employees")},o.getCoffeeTypes=function(){return e.get(n+"/coffeeTypes")},o.getCoffeePrices=function(){return e.get(n+"/coffeePrices")},o.setUserEquipment=function(t,o){return e({url:n+"/setUserEquipment",method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:$.param({equipmentId:t,equipmentTypeId:o})})},o}angular.module("coffeeGame").factory("gameSettingsService",e),e.$inject=["$http","serverUrl"]}(),function(){"use strict";function e(){var e=function(){this.items=[]};return e.prototype.Add=function(e,t){if(this.Exists(e)){var n=this.IndexOf(e);this.items[n].name=e,this.items[n].id=t.id,this.items[n].price=parseFloat(t.price),this.items[n].item=t.item}else this.items.push({name:e,id:t.id,price:parseFloat(t.price),item:t})},e.prototype.Exists=function(e,t){for(var n=0;n<this.items.length;n++)if(this.items[n].name==e&&(!t||this.items[n].id==t))return!0},e.prototype.IndexOf=function(e,t){for(var n=0;n<this.items.length;n++)if(this.items[n].name==e&&(!t||this.items[n].id==t))return n},e.prototype.getItemPrice=function(e){if(this.Exists(e)){var t=this.IndexOf(e);return parseFloat(this.items[t].price)}return 0},e.prototype.TotalAmount=function(){for(var e=0,t=0;t<this.items.length;t++)e+=parseFloat(this.items[t].price);return e},e.prototype.update=function(e){e()},e}angular.module("coffeeGame").factory("UserEquipment",e),e.$inject=[]}(),function(){"use strict";function e(e,t){var n=t+"/game/api/user",o={};return o.getBalance=function(){return e.get(n+"/balance")},o.heartbeat=function(){return e.get(n+"/heartbeat")},o}angular.module("coffeeGame").factory("userService",e),e.$inject=["$http","serverUrl"]}(),function(){"use strict";function e(e,t,n,o){function i(){a||(a=n(function(){o.heartbeat()},5e3))}function r(){a&&(n.cancel(a),a=void 0)}var a;t.$on("userLogin",function(){i()}),t.$on("userLogout",function(){r()})}angular.module("coffeeGame").controller("HeartbeatCtrl",e),e.$inject=["$scope","$rootScope","$timeout","userService"]}(),function(){"use strict";function e(e,t,n){function o(){n.validate().success(function(n){var o={id:n.user_id,cafeName:n.cafeName};""!=o.id&&void 0!=o.id?(e.user.authorized=!0,e.user.cafeName=o.cafeName,t.$broadcast("userLogin",o)):e.user.authorized=!1})}e.user={authorized:!1},o(),e.$on("$routeChangeStart",function(e,t){o()}),e.logout=function(){n.logout(),t.$broadcast("userLogout")}}angular.module("coffeeGame").controller("UserAuthCtrl",e),e.$inject=["$scope","$rootScope","authenticationService"]}(),function(){"use strict";function e(e){}angular.module("coffeeGame").controller("UserBalanceCtrl",e),e.$inject=["$scope"]}(),function(){"use strict";function e(e,t,n){e.game={},t.$on("gameStartEvent",function(){console.log("GameCtrl gameStartEvent"),e.game.equipmentChooseFinished=!0}),t.$on("userLogin",function(t,o){e.user=new n(o),e.user.getBalance()})}angular.module("coffeeGame").controller("GameCtrl",e),e.$inject=["$scope","$rootScope","User"]}(),function(){"use strict";function e(e,t,n){e.model={cafeName:"",password:""},e.login=function(){t.login({cafeName:e.model.cafeName,password:e.model.password,submit:"submit"}).success(function(e){n.path("/")})}}angular.module("coffeeGame").controller("LoginCtrl",e),e.$inject=["$scope","authenticationService","$location"]}(),function(){"use strict";function e(e,t){e.changeLanguage=function(e){t.uses(e),console.log("NOW is"+e)}}angular.module("coffeeGame").controller("TranslateCtrl",e),e.$inject=["$scope","$translate"]}(),function(){"use strict";function e(e,t){e.model={openedTime:0};var n=1e3;e.model.openedTimeDisplay=function(){return e.model.openedTime/2592},t(function(){e.model.openedTime=e.model.openedTime+1},n)}angular.module("coffeeGame").controller("GameProcessCtrl",e),e.$inject=["$scope","$interval"]}(),function(){"use strict";function e(e,t,n,o,i){function r(){n.getCoffeeGrinders().success(function(t){e.model.coffeeGrinders=t})}function a(){n.getCoffeeMachines().success(function(t){e.model.coffeeMachines=t})}function c(){n.getCoffeePlaces().success(function(t){e.model.coffeePlaces=t})}function s(){n.getCoffeeEmployees().success(function(t){e.model.coffeeEmployees=t})}function u(){n.getCoffeeTypes().success(function(t){e.model.coffeeTypes=t})}function f(){n.getCoffeePrices().success(function(t){e.model.coffeePrices=t})}function p(){console.log("errorr"),o.addSuccessMessage(i("translate")("THANKS_YOU_FINISHED")),t.$emit("gameStartEvent")}e.tabs=[{name:"Grinder",active:!0},{name:"Machine",active:!1},{name:"Place",active:!1},{name:"Employees",active:!1},{name:"Coffee",active:!1},{name:"Drink price",active:!1}],e.model={},r(),a(),c(),s(),u(),f(),e.openAccordion=function(e){var t="#accordion-"+e;$(t).click()},e.chooseCoffeeGinder=function(t){e.user.canBuyEquipment("grinder",t)?(e.user.equipment.Add("grinder",t),e.openAccordion(2),o.addSuccessMessage(i("translate")("THANKS_YOU_CHOSEN",{name:"Grinder"})),e.user.update(p)):o.addWarnMessage(i("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:"grinder"}))},e.chooseCoffeeMachine=function(t){e.user.canBuyEquipment("machine",t)?(e.user.equipment.Add("machine",t),e.openAccordion(3),o.addSuccessMessage(i("translate")("THANKS_YOU_CHOSEN",{name:"Machine"})),e.user.update(p)):o.addWarnMessage(i("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:"machine"}))},e.chooseCoffeePlace=function(t){e.user.canBuyEquipment("place",t)?(e.user.equipment.Add("place",t),e.openAccordion(4),o.addSuccessMessage(i("translate")("THANKS_YOU_CHOSEN",{name:"Place"})),e.user.update(p)):o.addWarnMessage(i("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:"place"}))},e.chooseCoffeeEmployee=function(t){e.user.canBuyEmployee(t.price)?(e.user.employee.Set(t),e.openAccordion(5),o.addSuccessMessage(i("translate")("THANKS_YOU_CHOSEN",{name:"Employee"})),e.user.update(p)):o.addWarnMessage(i("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:"employee"}))},e.chooseCoffeeType=function(t){e.user.canBuyCoffeeType(t.price)?(e.user.coffee.type.Set(t),e.openAccordion(6),o.addSuccessMessage(i("translate")("THANKS_YOU_CHOSEN",{name:"Coffee"})),e.user.update(p)):o.addWarnMessage(i("translate")("NOT_ENOUGTH_BALANCE_FOR",{name:"coffee type"}))},e.chooseCoffeePrice=function(t){e.user.coffee.price.Set(t),o.addSuccessMessage(i("translate")("THANKS_YOU_CHOSEN",{name:"Price"})),e.user.update(p)}}angular.module("coffeeGame").controller("StartEquipmentChooseCtrl",e),e.$inject=["$scope","$rootScope","gameSettingsService","growl","$filter"]}();